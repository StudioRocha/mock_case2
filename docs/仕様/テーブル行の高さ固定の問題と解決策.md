# テーブル行の高さ固定の問題と解決策

## 問題の概要

管理者用勤怠一覧画面（`/admin/attendance/list`）で、テーブルの行の高さがテキスト内容の有無によって変動してしまう問題が発生しました。

- **データがない行**: 高さが48pxで固定されている
- **データがある行**: テキストが入ると行の高さが少し高くなってしまう

## 原因

### 1. テキストノードはCSSで直接制御できない

CSSの`*`セレクタは**要素（element）のみ**を選択します。テキストノード（直接テキスト）は要素ではないため、CSSで直接`line-height`を設定できません。

```blade
{{-- これはテキストノード（CSSで直接制御できない） --}}
<td class="attendance-list-table__cell">
    {{ $attendance->user->name }}
</td>
```

```css
/* これは要素のみを選択するため、テキストノードには効かない */
.attendance-list-table__cell * {
    line-height: 48px;
}
```

### 2. `&nbsp;`とテキストでレンダリングが異なる

- `&nbsp;`: HTMLエンティティとして扱われる
- 通常のテキスト: テキストノードとして扱われる

テキストノードは親要素の`line-height`を継承しますが、ブラウザのデフォルトスタイルや他のCSS（`sanitize.css`の`html { line-height: 1.5; }`など）の影響で、高さが変動することがあります。

### 3. CSSだけでは解決できない

以下のようなCSSの設定を試しましたが、テキストノードには効きませんでした：

- `line-height: 48px`をセルに設定
- `*`セレクタで子要素に`line-height`を設定
- `!important`で強制適用
- `max-height`と`overflow: hidden`で制限

## 解決策

### Bladeファイル側の修正

すべてのテキストを`<span>`要素で囲むことで、テキストも要素として扱われ、CSSで`line-height`を直接制御できるようになります。

**修正前:**
```blade
<td class="attendance-list-table__cell">
    {{ $attendance->user->name ?? '-' }}
</td>
```

**修正後:**
```blade
<td class="attendance-list-table__cell">
    <span class="attendance-list-table__cell-text">{{ $attendance->user->name ?? '-' }}</span>
</td>
```

### CSS側の修正

`.attendance-list-table__cell-text`クラスに`line-height: 48px`を設定します。

```css
.attendance-list-table__cell-text {
    display: inline-block;
    line-height: 48px;
    vertical-align: middle;
    max-height: 48px;
    overflow: hidden;
}
```

## 適用ファイル

- **Bladeファイル**: `src/resources/views/admin/attendance/list.blade.php`
- **CSSファイル**: `src/public/css/attendance/list.css`

## 結果

テキストの有無に関わらず、すべての行の高さが48pxで統一されました。

## 学んだこと

1. **テキストノードはCSSで直接制御できない**
   - CSSの`*`セレクタは要素のみを選択する
   - テキストノードを制御するには、`<span>`などの要素で囲む必要がある

2. **テーブルの行の高さを固定するには**
   - セル内のすべてのコンテンツ（テキスト、リンクなど）を要素で囲む
   - その要素に`line-height`を設定する
   - セル自体にも`height`、`min-height`、`max-height`を設定する

3. **CSSだけでは解決できない場合がある**
   - HTMLの構造を変更することで、CSSで制御しやすくなる
   - Bladeファイル側の修正も検討する

## 参考

- [MDN: CSS セレクタ](https://developer.mozilla.org/ja/docs/Web/CSS/CSS_Selectors)
- [MDN: line-height](https://developer.mozilla.org/ja/docs/Web/CSS/line-height)
- [MDN: テキストノード](https://developer.mozilla.org/ja/docs/Web/API/Text)

