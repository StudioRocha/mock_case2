# ステータス定数の型比較：整数（int）vs 文字列（string）

## 概要

修正申請ステータスなどのクラス定数を、整数（`int`）と文字列（`string`）のどちらで定義するべきか、メリット・デメリットを比較したドキュメントです。

---

## 比較対象

### 整数（int）での定義

```php
class StampCorrectionRequest extends Model
{
    public const STATUS_PENDING = 0;   // 承認待ち
    public const STATUS_APPROVED = 1;  // 承認済み
}
```

### 文字列（string）での定義

```php
class StampCorrectionRequest extends Model
{
    public const STATUS_PENDING = 'pending';   // 承認待ち
    public const STATUS_APPROVED = 'approved'; // 承認済み
}
```

---

## 比較表

| 項目                 | 整数（int）                 | 文字列（string）                  |
| -------------------- | --------------------------- | --------------------------------- |
| **パフォーマンス**   | ✅ 高速（数値比較）         | ❌ やや遅い（文字列比較）         |
| **ストレージ効率**   | ✅ 4 バイト                 | ❌ 最大 20 バイト程度             |
| **可読性**           | ⚠️ 数値だけでは意味不明     | ✅ 文字列で意味が分かる           |
| **タイポリスク**     | ✅ 定数使用で安全           | ⚠️ 文字列リテラルでタイポのリスク |
| **拡張性**           | ✅ 数値を追加するだけ       | ✅ 文字列を追加するだけ           |
| **データベース設計** | ✅ `integer`型と整合        | ⚠️ `varchar`型が必要              |
| **インデックス効率** | ✅ 数値インデックスが高速   | ⚠️ 文字列インデックスはやや遅い   |
| **デバッグ**         | ⚠️ 数値だけでは分かりにくい | ✅ 文字列で内容が分かる           |
| **多言語対応**       | ✅ 表示用文字列を分離可能   | ⚠️ 文字列が混在する可能性         |

---

## 詳細比較

### 1. パフォーマンス

#### 整数（int）✅

```php
// 数値比較：高速
if ($request->status === StampCorrectionRequest::STATUS_PENDING) {
    // 処理
}

// データベースクエリも高速
$query->where('status', StampCorrectionRequest::STATUS_PENDING);
```

**メリット**:

-   CPU 処理が高速（数値比較は 1 命令で完了）
-   データベースのインデックス検索が高速
-   大量データでもパフォーマンスが安定

**デメリット**:

-   なし

#### 文字列（string）❌

```php
// 文字列比較：やや遅い
if ($request->status === StampCorrectionRequest::STATUS_PENDING) {
    // 処理
}

// データベースクエリもやや遅い
$query->where('status', StampCorrectionRequest::STATUS_PENDING);
```

**メリット**:

-   なし

**デメリット**:

-   文字列比較は文字数分の処理が必要
-   データベースのインデックス検索がやや遅い
-   大量データでパフォーマンスが低下する可能性

---

### 2. ストレージ効率

#### 整数（int）✅

```php
// データベースカラム
$table->integer('status');  // 4バイト固定
```

**メリット**:

-   1 レコードあたり 4 バイト（固定）
-   100 万レコードでも約 4MB
-   メモリ使用量も少ない

**デメリット**:

-   なし

#### 文字列（string）❌

```php
// データベースカラム
$table->string('status', 20);  // 最大20バイト
```

**メリット**:

-   なし

**デメリット**:

-   1 レコードあたり最大 20 バイト（可変長）
-   100 万レコードで最大 20MB
-   メモリ使用量が多い

---

### 3. 可読性

#### 整数（int）⚠️

```php
// コード上では意味が分かりにくい
if ($request->status === 0) {  // 0って何？
    // 処理
}

// 定数を使えば改善
if ($request->status === StampCorrectionRequest::STATUS_PENDING) {
    // 処理
}
```

**メリット**:

-   定数名で意味が明確になる

**デメリット**:

-   数値だけでは意味が分からない
-   デバッグ時に数値だけ表示されると分かりにくい

#### 文字列（string）✅

```php
// コード上でも意味が分かる
if ($request->status === 'pending') {
    // 処理
}

// 定数を使えばさらに明確
if ($request->status === StampCorrectionRequest::STATUS_PENDING) {
    // 処理
}
```

**メリット**:

-   文字列リテラルでも意味が分かる
-   デバッグ時に文字列が表示されると分かりやすい
-   ログファイルで内容が理解しやすい

**デメリット**:

-   なし

---

### 4. タイポリスク

#### 整数（int）✅

```php
// 定数を使用すればタイポのリスクがない
$request->status = StampCorrectionRequest::STATUS_PENDING;  // ✅ 安全

// ただし、数値リテラルを使うと危険
$request->status = 0;  // ⚠️ タイポのリスク（0とOの見間違いなど）
```

**メリット**:

-   定数使用でタイポのリスクがない
-   IDE の自動補完が効く

**デメリット**:

-   数値リテラルを直接使うと危険

#### 文字列（string）⚠️

```php
// 定数を使用すればタイポのリスクがない
$request->status = StampCorrectionRequest::STATUS_PENDING;  // ✅ 安全

// 文字列リテラルを使うとタイポのリスク
$request->status = 'pending';   // ✅ 正しい
$request->status = 'Pending';   // ❌ 大文字小文字の違い
$request->status = 'pendng';    // ❌ タイポ
```

**メリット**:

-   定数使用でタイポのリスクがない

**デメリット**:

-   文字列リテラルでタイポのリスクがある
-   大文字小文字の違いでバグが発生する可能性

---

### 5. 拡張性

#### 整数（int）✅

```php
// 将来ステータスを追加する場合
public const STATUS_PENDING = 0;   // 承認待ち
public const STATUS_APPROVED = 1;  // 承認済み
public const STATUS_REJECTED = 2;  // 却下（新規追加）
```

**メリット**:

-   数値を追加するだけなので簡単
-   データベースの型変更が不要

**デメリット**:

-   なし

#### 文字列（string）✅

```php
// 将来ステータスを追加する場合
public const STATUS_PENDING = 'pending';   // 承認待ち
public const STATUS_APPROVED = 'approved'; // 承認済み
public const STATUS_REJECTED = 'rejected'; // 却下（新規追加）
```

**メリット**:

-   文字列を追加するだけなので簡単
-   データベースの型変更が不要

**デメリット**:

-   なし

---

### 6. データベース設計

#### 整数（int）✅

```php
// マイグレーション
$table->integer('status');  // integer型

// インデックス
$table->index('status');  // 数値インデックス（高速）
```

**メリット**:

-   `integer`型で統一できる
-   インデックスが高速
-   外部キー制約も設定しやすい

**デメリット**:

-   なし

#### 文字列（string）⚠️

```php
// マイグレーション
$table->string('status', 20);  // varchar型

// インデックス
$table->index('status');  // 文字列インデックス（やや遅い）
```

**メリット**:

-   なし

**デメリット**:

-   `varchar`型が必要
-   インデックスがやや遅い
-   文字数制限を考慮する必要がある

---

### 7. デバッグ

#### 整数（int）⚠️

```php
// ログ出力
Log::info('Status: ' . $request->status);  // Status: 0

// データベースの値
// status: 0
```

**メリット**:

-   定数名で意味が分かる

**デメリット**:

-   数値だけでは意味が分からない
-   デバッグ時に定数名を確認する必要がある

#### 文字列（string）✅

```php
// ログ出力
Log::info('Status: ' . $request->status);  // Status: pending

// データベースの値
// status: pending
```

**メリット**:

-   文字列で内容が分かる
-   デバッグ時に意味が理解しやすい
-   ログファイルで内容が明確

**デメリット**:

-   なし

---

### 8. 多言語対応

#### 整数（int）✅

```php
// データベースには数値のみ保存
$request->status = StampCorrectionRequest::STATUS_PENDING;  // 0

// 表示用の文字列はコード側で管理
$labels = [
    StampCorrectionRequest::STATUS_PENDING => '承認待ち',
    StampCorrectionRequest::STATUS_APPROVED => '承認済み',
];

echo $labels[$request->status];  // 承認待ち
```

**メリット**:

-   データベースと表示用文字列を分離できる
-   多言語対応が容易（翻訳ファイルで管理）
-   表示用文字列の変更がデータベースに影響しない

**デメリット**:

-   ラベル配列の管理が必要

#### 文字列（string）⚠️

```php
// データベースに文字列を保存
$request->status = StampCorrectionRequest::STATUS_PENDING;  // 'pending'

// 表示用の文字列も文字列
$labels = [
    'pending' => '承認待ち',
    'approved' => '承認済み',
];

echo $labels[$request->status];  // 承認待ち
```

**メリット**:

-   ラベル配列の管理が必要（整数と同じ）

**デメリット**:

-   データベースと表示用文字列が混在する可能性
-   多言語対応時に文字列が混在しやすい

---

## 実装例の比較

### 整数（int）での実装

```php
// モデル
class StampCorrectionRequest extends Model
{
    public const STATUS_PENDING = 0;
    public const STATUS_APPROVED = 1;
}

// 使用例
$request->status = StampCorrectionRequest::STATUS_PENDING;

// クエリ
$query->where('status', StampCorrectionRequest::STATUS_PENDING);

// 表示用ラベル
$labels = [
    StampCorrectionRequest::STATUS_PENDING => '承認待ち',
    StampCorrectionRequest::STATUS_APPROVED => '承認済み',
];
```

### 文字列（string）での実装

```php
// モデル
class StampCorrectionRequest extends Model
{
    public const STATUS_PENDING = 'pending';
    public const STATUS_APPROVED = 'approved';
}

// 使用例
$request->status = StampCorrectionRequest::STATUS_PENDING;

// クエリ
$query->where('status', StampCorrectionRequest::STATUS_PENDING);

// 表示用ラベル
$labels = [
    StampCorrectionRequest::STATUS_PENDING => '承認待ち',
    StampCorrectionRequest::STATUS_APPROVED => '承認済み',
];
```

---

## 推奨事項

### 整数（int）を推奨する場合

✅ **以下の条件に当てはまる場合**:

-   パフォーマンスが重要（大量データを扱う）
-   ストレージ効率を重視する
-   データベースのインデックス検索が頻繁
-   多言語対応を予定している
-   ステータスの種類が少ない（10 種類以下）

### 文字列（string）を推奨する場合

✅ **以下の条件に当てはまる場合**:

-   可読性を最優先する
-   デバッグのしやすさを重視する
-   ステータスの種類が多い（10 種類以上）
-   パフォーマンス要件が緩い
-   小規模なアプリケーション

---

## 結論

このアプリケーションでは、**整数（int）での定義を推奨**します。

### 理由

1. **パフォーマンス**: 勤怠データは大量になる可能性があり、数値比較の高速性が重要
2. **ストレージ効率**: データベースの容量を節約できる
3. **データベース設計**: `integer`型で統一でき、インデックス効率が良い
4. **多言語対応**: 表示用文字列をコード側で管理でき、将来の拡張性が高い
5. **拡張性**: ステータスを追加する際も数値を追加するだけ

### 注意点

-   定数を使用することで可読性の問題は解決できる
-   デバッグ時は定数名を確認するか、ラベル配列を使用する
-   表示用文字列は必ずラベル配列で管理する

---

## 参考資料

-   [修正申請ステータス.md](./修正申請ステータス.md)
-   [機能要件一覧.md](./機能要件一覧.md)
