# テーブル状態チェック結果

## 比較日時

2025 年 11 月 12 日

## 比較対象

-   **設計案**: `docs/仕様/テーブル設計案.md`
-   **実装**: `src/database/migrations/*.php`

---

## 1. users テーブル

### 設計案の要件

| カラム名          | 型           | PRIMARY KEY | UNIQUE KEY | NOT NULL | FOREIGN KEY |
| ----------------- | ------------ | ----------- | ---------- | -------- | ----------- |
| id                | unsigned int | ○           |            | ○        |             |
| name              | varchar(255) |             |            | ○        |             |
| email             | varchar(255) |             | ○          | ○        |             |
| email_verified_at | timestamp    |             |            |          |             |
| password          | varchar(255) |             |            | ○        |             |
| role              | integer      |             |            | ○        |             |
| remember_token    | varchar(100) |             |            |          |             |
| created_at        | timestamp    |             |            |          |             |
| updated_at        | timestamp    |             |            |          |             |

### 実装状態

```php
$table->unsignedInteger('id')->primary();
$table->string('name');
$table->string('email')->unique();
$table->timestamp('email_verified_at')->nullable();
$table->string('password');
$table->integer('role');
$table->rememberToken();
$table->timestamps();
```

### チェック結果

✅ **一致** - すべてのカラムが設計案通りに実装されています

---

## 2. attendances テーブル

### 設計案の要件

| カラム名       | 型           | PRIMARY KEY | UNIQUE KEY | NOT NULL | FOREIGN KEY |
| -------------- | ------------ | ----------- | ---------- | -------- | ----------- |
| id             | unsigned int | ○           |            | ○        |             |
| user_id        | unsigned int |             |            | ○        | users(id)   |
| date           | date         |             |            | ○        |             |
| clock_in_time  | datetime     |             |            |          |             |
| clock_out_time | datetime     |             |            |          |             |
| status         | integer      |             |            | ○        |             |
| note           | varchar(500) |             |            | ○        |             |
| created_at     | timestamp    |             |            |          |             |
| updated_at     | timestamp    |             |            |          |             |

**備考**: `user_id`と`date`の組み合わせでユニーク制約を検討

### 実装状態

```php
$table->unsignedInteger('id')->primary();
$table->unsignedInteger('user_id');
$table->foreign('user_id')->references('id')->on('users')->onDelete('cascade');
$table->date('date');
$table->datetime('clock_in_time')->nullable();
$table->datetime('clock_out_time')->nullable();
$table->integer('status');
$table->string('note', 500);
$table->timestamps();
$table->unique(['user_id', 'date']); // ✅ ユニーク制約が実装されている
```

### チェック結果

✅ **一致** - すべてのカラムが設計案通りに実装されています
✅ **追加実装**: `user_id`と`date`のユニーク制約が実装されています（設計案では検討事項）

---

## 3. break_times テーブル

### 設計案の要件

| カラム名         | 型           | PRIMARY KEY | UNIQUE KEY | NOT NULL | FOREIGN KEY     |
| ---------------- | ------------ | ----------- | ---------- | -------- | --------------- |
| id               | unsigned int | ○           |            | ○        |                 |
| attendance_id    | unsigned int |             |            | ○        | attendances(id) |
| break_start_time | datetime     |             |            |          |                 |
| break_end_time   | datetime     |             |            |          |                 |
| created_at       | timestamp    |             |            |          |                 |
| updated_at       | timestamp    |             |            |          |                 |

### 実装状態

```php
$table->unsignedInteger('id')->primary();
$table->unsignedInteger('attendance_id');
$table->foreign('attendance_id')->references('id')->on('attendances')->onDelete('cascade');
$table->datetime('break_start_time')->nullable();
$table->datetime('break_end_time')->nullable();
$table->timestamps();
```

### チェック結果

✅ **一致** - すべてのカラムが設計案通りに実装されています

---

## 4. stamp_correction_requests テーブル

### 設計案の要件

| カラム名                 | 型           | PRIMARY KEY | UNIQUE KEY | NOT NULL | FOREIGN KEY     |
| ------------------------ | ------------ | ----------- | ---------- | -------- | --------------- |
| id                       | unsigned int | ○           |            | ○        |                 |
| attendance_id            | unsigned int |             |            | ○        | attendances(id) |
| requested_clock_in_time  | datetime     |             |            |          |                 |
| requested_clock_out_time | datetime     |             |            |          |                 |
| requested_note           | varchar(500) |             |            | ○        |                 |
| status                   | integer      |             |            | ○        |                 |
| approved_at              | timestamp    |             |            |          |                 |
| created_at               | timestamp    |             |            |          |                 |
| updated_at               | timestamp    |             |            |          |                 |

### 実装状態

```php
$table->unsignedInteger('id')->primary();
$table->unsignedInteger('attendance_id');
$table->foreign('attendance_id')->references('id')->on('attendances')->onDelete('cascade');
$table->datetime('requested_clock_in_time')->nullable();
$table->datetime('requested_clock_out_time')->nullable();
$table->string('requested_note', 500);
$table->integer('status');
$table->timestamp('approved_at')->nullable();
$table->timestamps();
```

### チェック結果

✅ **一致** - すべてのカラムが設計案通りに実装されています

---

## 5. break_corrections テーブル

### 設計案の要件

| カラム名                    | 型           | PRIMARY KEY | UNIQUE KEY | NOT NULL | FOREIGN KEY                   |
| --------------------------- | ------------ | ----------- | ---------- | -------- | ----------------------------- |
| id                          | unsigned int | ○           |            | ○        |                               |
| stamp_correction_request_id | unsigned int |             |            | ○        | stamp_correction_requests(id) |
| requested_break_start_time  | datetime     |             |            |          |                               |
| requested_break_end_time    | datetime     |             |            |          |                               |
| created_at                  | timestamp    |             |            |          |                               |
| updated_at                  | timestamp    |             |            |          |                               |

### 実装状態

```php
$table->unsignedInteger('id')->primary();
$table->unsignedInteger('stamp_correction_request_id');
$table->foreign('stamp_correction_request_id')->references('id')->on('stamp_correction_requests')->onDelete('cascade');
$table->datetime('requested_break_start_time')->nullable();
$table->datetime('requested_break_end_time')->nullable();
$table->timestamps();
```

### チェック結果

✅ **一致** - すべてのカラムが設計案通りに実装されています

---

## 総合結果

### ✅ すべてのテーブルが設計案通りに実装されています

### 実装済みの追加機能

1. **attendances テーブル**: `user_id`と`date`のユニーク制約が実装済み（設計案では検討事項）

### 外部キー制約

すべてのテーブルで外部キー制約が適切に設定されており、`onDelete('cascade')`も実装されています。

### 注意事項

-   設計案では`NOT NULL`と記載されているカラムでも、実装では`nullable()`が設定されているカラムがあります
    -   これは Laravel のマイグレーションのデフォルト動作で、明示的に`->nullable()`を指定しない限り`NOT NULL`になります
    -   現在の実装では、設計案で`NOT NULL`とされているカラムは適切に`NOT NULL`制約が設定されています

---

## テーブル一覧

| テーブル名                | 状態    | 備考                 |
| ------------------------- | ------- | -------------------- |
| users                     | ✅ 一致 |                      |
| attendances               | ✅ 一致 | ユニーク制約実装済み |
| break_times               | ✅ 一致 |                      |
| stamp_correction_requests | ✅ 一致 |                      |
| break_corrections         | ✅ 一致 |                      |
