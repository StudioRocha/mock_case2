# 機能要件一覧

## 概要

勤怠管理アプリの機能要件一覧

---

## 機能要件

### US001: 新規一般ユーザーは，システムの一般機能に会員登録することができる。

| 要件 ID | 機能一覧                     | 機能詳細（完了状態）                                                                                                                                                                                                                                                                                                                                                          |
| ------- | ---------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| FN001   | 登録認証機能（一般ユーザー） | 使用技術 : fortify                                                                                                                                                                                                                                                                                                                                                            |
| FN002   | バリデーション               | 使用技術：formrequest<br>バリデーションルールは FN003 を参照すること                                                                                                                                                                                                                                                                                                          |
| FN003   | エラーメッセージ表示         | **1. 未入力の場合**<br> 1. お名前を入力してください<br> 2. メールアドレスを入力してください<br> 3. パスワードを入力してください<br><br>**2. パスワードの入力規則違反の場合**<br> 1. パスワードは 8 文字以上で入力してください<br><br>**3. 確認用パスワードの入力規則違反の場合**<br> 1. パスワードと一致しません<br><br>※以上の文言は必ず守ってください。評価項目になります。 |
| FN004   | ユーザー認証動線             | 会員登録画面からログイン画面に遷移できる                                                                                                                                                                                                                                                                                                                                      |
| FN005   | 初回ログイン時ユーザー設定   | 会員登録直後、打刻画面に遷移すること（メール認証を実装しなかった場合）                                                                                                                                                                                                                                                                                                        |

---

### US002: 一般ユーザーは，システムの一般機能にログインすることができる。

| 要件 ID | 機能一覧                         | 機能詳細（完了状態）                                                                                                                                                                                                                                                                                                                                                                                               |
| ------- | -------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| FN006   | ログイン認証機能（一般ユーザー） | 使用技術 : fortify                                                                                                                                                                                                                                                                                                                                                                                                 |
| FN007   | 入力フォーム                     | **必要な情報**<br>1. メールアドレス<br>2. パスワード                                                                                                                                                                                                                                                                                                                                                               |
| FN008   | バリデーション                   | 使用技術：formrequest<br>バリデーションルールは本シートを参照し、必要に応じて適時埋めること                                                                                                                                                                                                                                                                                                                        |
| FN009   | エラーメッセージ表示             | **1. 未入力の場合**<br> 1. メールアドレスを入力してください<br> 2. パスワードを入力してください<br><br>**2. 入力情報が誤っている場合**<br> 1. ログイン情報が登録されていません                                                                                                                                                                                                                                     |
| FN010   | ユーザー認証動線                 | ログイン画面から会員登録画面に遷移できる                                                                                                                                                                                                                                                                                                                                                                           |
| FN011   | メールを用いた認証機能           | **TODO: 応用要件として実装予定（他の機能をすべて実装後に取り掛かる）**<br><br>1. 新規会員登録にメール認証を行う<br>2. 新規会員登録後にメール認証をしないでログインを試みた場合はメール認証誘導画面へ遷移<br>3. メール認証を実装した際の画面遷移<br>　 a. 初回会員登録<br>　 b. メール認証誘導画面<br>　 c. メール認証画面<br>4. メール認証を行うのは会員登録時、初回ログイン時<br>5. 使用技術：mailhog か mailtrap |
| FN012   | 認証メール再送機能               | **TODO: 応用要件として実装予定（他の機能をすべて実装後に取り掛かる）**<br><br>メール認証誘導画面で「認証メール再送」ボタンをクリックすると認証メールを再送信される                                                                                                                                                                                                                                                 |

---

### US003: 一般ユーザーは，システムの一般機能からログアウトすることができる。

| 要件 ID | 機能一覧       | 機能詳細（完了状態）                                              |
| ------- | -------------- | ----------------------------------------------------------------- |
| FN013   | ログアウト機能 | 使用技術：fortify<br>ヘッダーのボタンから正常にログアウトを行える |

---

### US004: 管理者ユーザーは，システムの管理機能にログインすることができる。

| 要件 ID | 機能一覧                   | 機能詳細（完了状態）                                                                                                                                                           |
| ------- | -------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| FN014   | ログイン認証機能（管理者） | 使用技術 : fortify                                                                                                                                                             |
| FN015   | バリデーション機能         | 使用技術：formrequest<br>バリデーションルールは FN016 を参照すること                                                                                                           |
| FN016   | エラーメッセージ表示機能   | **1. 未入力の場合**<br> 1. メールアドレスを入力してください<br> 2. パスワードを入力してください<br><br>**2. 入力情報が誤っている場合**<br> 1. ログイン情報が登録されていません |

---

### US005: 管理者ユーザーは，管理機能からログアウトすることができる。

| 要件 ID | 機能一覧       | 機能詳細（完了状態）                                              |
| ------- | -------------- | ----------------------------------------------------------------- |
| FN017   | ログアウト機能 | 使用技術：fortify<br>ヘッダーのボタンから正常にログアウトを行える |

---

### US006: 一般ユーザーは，勤怠の打刻をすることができる

| 要件 ID | 機能一覧           | 機能詳細（完了状態）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| ------- | ------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| FN018   | 日時情報取得機能   | 現在の日時情報が UI と同じ形式で出力されていること                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| FN019   | ステータス確認機能 | 以下のステータスが表示されていること<br>勤務外，出勤中，休憩中，退勤済                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| FN020   | 出勤機能           | 1. 勤務外のステータスを持つときに「出勤」というボタンが表示されていること<br>2. 「出勤」は 1 日に 1 回だけ押下できること<br>3. 「出勤」を押下した時に，画面が「出勤中」ステータスのものに変更になること<br>4. 出勤時刻が管理画面から正確に確認できること                                                                                                                                                                                                                                                                                                        |
| FN021   | 休憩機能           | 1. 「出勤中」のステータスを持つときに「休憩」というボタンが表示されていること<br>2. 「休憩入」ボタンは 1 日に何回でも押下できる<br>3. 「休憩入」ボタンを押下した時に，画面が「休憩中」ステータスのものに変更になること<br>4. 「休憩中」のステータスを持つときに「休憩戻」というボタンが表示されていること<br>5. 「休憩戻」ボタンは 1 日に何回でも押下できる<br>　 a. 勤怠詳細画面で休憩回数分のレコードを作成する<br>6. 「休憩戻」ボタンを押下した時に，画面が「出勤中」ステータスのものに変更になること<br>7. 休憩に関する時刻が管理画面で正確に確認できること |
| FN022   | 退勤機能           | 1. 「出勤中」のステータスを持つときに「退勤」というボタンが表示されていること<br>2. 「退勤」ボタンは 1 日に 1 回だけ押下できる<br>3. 「退勤」ボタンを押下した時に，「お疲れ様でした。」とメッセージが表示される<br>4. 「退勤」ボタンを押下した時に，「退勤済」というステータスに変更される<br>5. 退勤時刻が管理画面から確認できること                                                                                                                                                                                                                           |

---

### US007: 一般ユーザーは，勤怠一覧を確認することができる

| 要件 ID | 機能一覧             | 機能詳細（完了状態）                                                                                                                                          |
| ------- | -------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| FN023   | 勤怠一覧情報取得機能 | 1. 自分が行った勤怠情報が全て表示されていること<br>2. カラムが UI と同じ構成になっていること。（勤怠情報がないフィールドは空白になっていること）              |
| FN024   | 月情報取得機能       | 1. 遷移した際に現在の月が表示される<br>2. 「前月」を押下した時に，表示月の前月の情報が表示される<br>3. 「翌月」を押下した時に，表示月の翌月の情報が表示される |
| FN025   | 詳細遷移機能         | 「詳細」を押下すると，その日の勤怠詳細画面に遷移すること                                                                                                      |

---

### US008: 一般ユーザーは，勤怠詳細を確認 / 修正申請することができる

| 要件 ID | 機能一覧                 | 機能詳細（完了状態）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| ------- | ------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| FN026   | 詳細情報取得機能         | 1. 「名前」が，自分の氏名になっていること<br>2. 「日付」が，動線上で自分が選択した日時と一致していること<br>3. 「出勤・退勤」「休憩」にて記されている時間が，自分の打刻と一致していること<br>4. 「休憩」について、休憩回数分のレコードと追加で１つ分の入力フィールドが表示されること                                                                                                                                                                                                                                                               |
| FN027   | 項目編集機能             | 「出勤・退勤」「休憩」「備考」の 3 つの項目において，修正したい内容を記載できるフィールドになっていること<br><br>「承認待ち」の申請詳細は，修正を行うことができず，<br>「承認待ちのため修正はできません。」とメッセージが表示されていること                                                                                                                                                                                                                                                                                                        |
| FN028   | バリデーション機能       | 使用技術：formrequest<br>バリデーションルールは別シート「基本設計書」を参照                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| FN029   | エラーメッセージ表示機能 | 1. 出勤時間が退勤時間より後になっている場合，および退勤時間が出勤時間より前になっている場合に以下のメッセージを表示<br>　・出勤時間もしくは退勤時間が不適切な値です<br><br>2. 休憩開始時間が出勤時間より前になっている場合及び退勤時間より後になっている場合、以下のメッセージを表示<br>　・休憩時間が不適切な値です<br><br>3. 休憩終了時間が退勤時間より後になっている場合、以下のメッセージを表示<br>　・休憩時間もしくは退勤時間が不適切な値です<br><br>4. 備考欄が未入力になっている際に，以下のメッセージを表示<br>　・備考を記入してください |
| FN030   | 修正申請機能             | 「修正」ボタンを押下すると，修正申請が実行されること<br><br>修正申請が実行されると，その勤怠情報は以下のように扱われること<br>　 1. 管理者ユーザーの「修正申請承認画面」に表示される<br>　 2. 一般ユーザーの「申請一覧画面」の"承認待ち"内に表示される                                                                                                                                                                                                                                                                                             |

---

### US009: 一般ユーザーは，自分が行った申請を確認することができる

| 要件 ID | 機能一覧             | 機能詳細（完了状態）                                                                                                                                                                                      |
| ------- | -------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| FN031   | 承認待ち情報取得機能 | 1. "承認待ち"には，自分が行った申請のうち，管理者が承認していないものが全て表示されていること<br>2. 各項目には UI と同一の項目が表示されていること<br>3. 管理者によって承認された場合は，承認済み移動する |
| FN032   | 承認済み情報取得機能 | 1. "承認済み"には，管理者が承認した修正申請が全て表示されていること<br>2. 各項目には UI と同一の項目が表示されていること                                                                                  |
| FN033   | 申請詳細表示機能     | 1. 各項目の「詳細」を押下すると，勤怠詳細画面に遷移すること<br>2. 「承認待ち」の申請詳細は，修正を行うことができず，「承認待ちのため修正はできません。」とメッセージが表示されていること                  |

---

### US010: 管理者ユーザーは日次勤怠一覧を確認することができる

| 要件 ID | 機能一覧         | 機能詳細（完了状態）                                                                                                                                                                                    |
| ------- | ---------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| FN034   | 勤怠情報取得機能 | 1. その日になされた全ユーザーの勤怠情報が確認できること<br>2. 勤怠情報が正確な値になっていること<br>3. リストのカラムが UI と一致していること（まだされていない勤怠のフィールドは空白になっていること） |
| FN035   | 日時変更機能     | 1. 遷移した際に現在の日付が表示されること<br>2. 「前日」を押下した時に，前の日の勤怠情報が表示されること<br>3. 「翌日」を押下した時に，次の日の勤怠情報が表示されること                                 |
| FN036   | 勤怠詳細表示機能 | 各勤怠の「詳細」を押下した際に，勤怠詳細画面に遷移すること                                                                                                                                              |

---

### US011: 管理者ユーザーは各勤怠の詳細を確認・修正することができる

| 要件 ID | 機能一覧           | 機能詳細（完了状態）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| ------- | ------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| FN037   | 詳細情報取得機能   | 1. 詳細画面の内容が，動線上で自分が選択した情報と一致していること<br>2. 詳細画面の内容が，正しく実際の勤怠内容が反映されていること                                                                                                                                                                                                                                                                                                                                                                                                                 |
| FN038   | 項目編集機能       | 「出勤・退勤」「休憩」「備考」の 4 つの項目において，修正したい内容を記載できるフィールドになっていること<br><br>「承認待ち」の申請詳細は，修正を行うことができず，<br>「承認待ちのため修正はできません。」とメッセージが表示されていること                                                                                                                                                                                                                                                                                                        |
| FN039   | バリデーション機能 | 1. 出勤時間が退勤時間より後になっている場合，および退勤時間が出勤時間より前になっている場合に以下のメッセージを表示<br>　・出勤時間もしくは退勤時間が不適切な値です<br><br>2. 休憩開始時間が出勤時間より前になっている場合及び退勤時間より後になっている場合、以下のメッセージを表示<br>　・休憩時間が不適切な値です<br><br>3. 休憩終了時間が退勤時間より後になっている場合、以下のメッセージを表示<br>　・休憩時間もしくは退勤時間が不適切な値です<br><br>4. 備考欄が未入力になっている際に，以下のメッセージを表示<br>　・備考を記入してください |
| FN040   | 修正機能           | 1. 「修正」ボタンを押下すると，管理者として直接修正が実行されること<br>2. 修正された内容は一般ユーザーの勤怠情報としても反映されていること                                                                                                                                                                                                                                                                                                                                                                                                         |

---

### US012: 管理者ユーザーはスタッフ一覧を確認することができる

| 要件 ID | 機能一覧             | 機能詳細（完了状態）                                                   |
| ------- | -------------------- | ---------------------------------------------------------------------- |
| FN041   | ユーザー情報取得機能 | 全一般ユーザーの「氏名」「メールアドレス」が正しく表示されていること   |
| FN042   | 月次勤怠遷移機能     | 「詳細」を押下することによって，各ユーザーの月次勤怠一覧に遷移すること |

---

### US013: 管理者ユーザーはスタッフ毎の月次勤怠一覧を確認することができる

| 要件 ID | 機能一覧             | 機能詳細（完了状態）                                                                                                                                                                |
| ------- | -------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| FN043   | 勤怠一覧情報取得機能 | 1. 動線上選択したユーザーの勤怠情報が全て表示されていること<br>2. カラムが UI と同じ構成になっていること。（勤怠情報がないフィールドは空白になっていること）                        |
| FN044   | 月表示変更機能       | 1. 遷移した際に現在の月が表示されること<br>2. 「前月」を押下した時に，表示月の前月の情報が表示されること<br>3. 「翌月」を押下した時に，表示月の翌月の情報が表示されること           |
| FN045   | CSV 出力機能         | **TODO: 応用要件として実装予定（他の機能をすべて実装後に取り掛かる）**<br><br>「CSV 出力」を押下すると，当該ユーザーが選択した月で行った勤怠一覧情報が CSV でダウンロードできること |
| FN046   | 詳細遷移機能         | 「詳細」を押下すると，その日の勤怠詳細画面に遷移すること                                                                                                                            |

---

### US014: 管理者ユーザーは修正申請一覧を確認することができる

| 要件 ID | 機能一覧             | 機能詳細（完了状態）                                                                                                                           |
| ------- | -------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------- |
| FN047   | 承認待ち情報取得機能 | 1. "承認待ち"には全ての一般ユーザーが行った未承認の修正申請が全て表示されていること<br>2. カラムの項目が UI と一致していること                 |
| FN048   | 承認済み情報取得機能 | 1. "承認済み"には，全ての一般ユーザーが行った，これまでの承認済みの修正申請が全て表示されていること<br>2. カラムの項目が UI と一致していること |
| FN049   | 申請詳細遷移機能     | 各項目の「詳細」を押下すると，申請詳細画面に遷移すること                                                                                       |

---

### US015: 管理者ユーザーは修正申請の詳細を確認 / 承認することができる

| 要件 ID | 機能一覧         | 機能詳細（完了状態）                                                                                                                                                                                                                                                                              |
| ------- | ---------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| FN050   | 申請詳細取得機能 | 1. 詳細画面の内容が，動線上で自分が選択した情報と一致していること<br>2. 詳細画面の内容が，正しく実際の打刻内容が反映されていること                                                                                                                                                                |
| FN051   | 承認機能         | 「承認」を行うと以下の振る舞いをすること<br><br>1. 管理者ユーザーの「修正申請一覧」で，"承認待ち"から"承認済み"に変更されていること<br>2. 一般ユーザーの当該勤怠情報が更新され，修正申請の内容と一致すること<br>3. 一般ユーザーの「修正申請一覧」で，"承認待ち"から"承認済み"に変更されていること |

---

## 応用要件（実装予定）

以下の機能は、他の機能をすべて実装後に取り掛かる予定です。拡張しやすいように準備しておく必要があります。

### 1. メールを用いた認証機能（FN011）

**実装位置**: US002（一般ユーザーログイン機能）内

**TODO コメント例**:

```php
// TODO: 応用要件 - メール認証機能の実装
// 1. 新規会員登録にメール認証を行う
// 2. メール認証誘導画面の作成
// 3. メール認証画面の作成
// 4. mailhogまたはmailtrapを使用したメール送信機能
// 5. メール認証状態の管理（usersテーブルのemail_verified_atカラムを使用）
```

### 2. 認証メール再送機能（FN012）

**実装位置**: US002（一般ユーザーログイン機能）内、メール認証誘導画面

**TODO コメント例**:

```php
// TODO: 応用要件 - 認証メール再送機能の実装
// メール認証誘導画面に「認証メール再送」ボタンを追加
// 再送ボタンクリック時に認証メールを再送信する処理を実装
```

### 3. CSV 出力機能（FN045）

**実装位置**: US013（スタッフ毎の月次勤怠一覧）内

**TODO コメント例**:

```php
// TODO: 応用要件 - CSV出力機能の実装
// 1. 「CSV出力」ボタンの追加
// 2. 選択した月の勤怠一覧情報をCSV形式で出力
// 3. attendancesテーブルとbreak_timesテーブルをJOINして出力
// 4. ファイルダウンロード機能の実装
```

---

## 実装優先順位

1. **基本機能（必須）**: US001 ～ US015（FN011, FN012, FN045 を除く）
2. **応用要件（後回し）**: FN011（メール認証）、FN012（認証メール再送）、FN045（CSV 出力）

応用要件の実装は、「応用要件を進める」という合図を待ってから開始してください。
