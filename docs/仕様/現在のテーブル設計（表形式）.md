# 現在のテーブル設計（表形式）

## usersテーブル

| カラム名            | データ型        | PRIMARY KEY | NOT NULL | UNIQUE | FK（参照先） |
| ------------------ | -------------- | ----------- | -------- | ------ | ------------ |
| `id`               | unsigned int   | ○           | ○        |        |              |
| `name`             | varchar(255)   |             | ○        |        |              |
| `email`            | varchar(255)   |             | ○        | ○      |              |
| `email_verified_at` | timestamp     |             |          |        |              |
| `password`         | varchar(255)   |             | ○        |        |              |
| `role_id`          | unsigned int   |             | ○        |        | roles(id)     |
| `remember_token`   | varchar(100)   |             |          |        |              |
| `created_at`       | timestamp      |             |          |        |              |
| `updated_at`       | timestamp      |             |          |        |              |

---

## rolesテーブル

| カラム名     | データ型      | PRIMARY KEY | NOT NULL | UNIQUE | FK（参照先） |
| ------------ | ------------- | ----------- | -------- | ------ | ------------ |
| `id`         | unsigned int  | ○           | ○        |        |              |
| `name`       | varchar(255)   |             | ○        | ○      |              |
| `label`      | varchar(255)   |             | ○        |        |              |
| `created_at` | timestamp     |             |          |        |              |
| `updated_at` | timestamp     |             |          |        |              |

---

## attendancesテーブル（勤怠）

| カラム名         | データ型      | PRIMARY KEY | NOT NULL | UNIQUE | FK（参照先） |
| ---------------- | ------------ | ----------- | -------- | ------ | ------------ |
| `id`             | unsigned int | ○           | ○        |        |              |
| `user_id`        | unsigned int |             | ○        |        | users(id)    |
| `date`           | date         |             | ○        |        |              |
| `clock_in_time`  | datetime     |             |          |        |              |
| `clock_out_time` | datetime     |             |          |        |              |
| `status`         | unsigned int |             | ○        |        |              |
| `note`           | varchar(500) |             |          |        |              |
| `created_at`     | timestamp    |             |          |        |              |
| `updated_at`     | timestamp    |             |          |        |              |

**備考**: `user_id`と`date`の組み合わせでUNIQUE制約（1ユーザー1日1レコード）

---

## break_timesテーブル（休憩）

| カラム名           | データ型      | PRIMARY KEY | NOT NULL | UNIQUE | FK（参照先）    |
| ------------------ | ------------ | ----------- | -------- | ------ | --------------- |
| `id`               | unsigned int | ○           | ○        |        |                 |
| `attendance_id`    | unsigned int |             | ○        |        | attendances(id) |
| `break_start_time` | datetime     |             |          |        |                 |
| `break_end_time`   | datetime     |             |          |        |                 |
| `created_at`       | timestamp    |             |          |        |                 |
| `updated_at`       | timestamp    |             |          |        |                 |

---

## stamp_correction_requestsテーブル（勤怠修正申請）

| カラム名                   | データ型      | PRIMARY KEY | NOT NULL | UNIQUE | FK（参照先）    |
| -------------------------- | ------------ | ----------- | -------- | ------ | --------------- |
| `id`                       | unsigned int | ○           | ○        |        |                 |
| `attendance_id`            | unsigned int |             | ○        |        | attendances(id) |
| `requested_clock_in_time`  | datetime     |             |          |        |                 |
| `requested_clock_out_time` | datetime     |             |          |        |                 |
| `requested_note`           | varchar(500) |             | ○        |        |                 |
| `status`                   | unsigned int |             | ○        |        |                 |
| `approved_at`              | timestamp    |             |          |        |                 |
| `created_at`               | timestamp    |             |          |        |                 |
| `updated_at`               | timestamp    |             |          |        |                 |

---

## break_correctionsテーブル（休憩修正申請）

| カラム名                      | データ型      | PRIMARY KEY | NOT NULL | UNIQUE | FK（参照先）                    |
| ----------------------------- | ------------ | ----------- | -------- | ------ | ------------------------------- |
| `id`                          | unsigned int | ○           | ○        |        |                                 |
| `stamp_correction_request_id` | unsigned int |             | ○        |        | stamp_correction_requests(id)   |
| `requested_break_start_time`  | datetime     |             |          |        |                                 |
| `requested_break_end_time`    | datetime     |             |          |        |                                 |
| `created_at`                  | timestamp    |             |          |        |                                 |
| `updated_at`                  | timestamp    |             |          |        |                                 |

---

## 外部キー制約の詳細

| テーブル                    | 外部キーカラム              | 参照先テーブル              | 参照先カラム | ON DELETE |
| --------------------------- | -------------------------- | --------------------------- | ------------ | --------- |
| `users`                     | `role_id`                  | `roles`                     | `id`         | RESTRICT  |
| `attendances`               | `user_id`                  | `users`                     | `id`         | CASCADE   |
| `break_times`               | `attendance_id`            | `attendances`               | `id`         | CASCADE   |
| `stamp_correction_requests` | `attendance_id`            | `attendances`               | `id`         | CASCADE   |
| `break_corrections`         | `stamp_correction_request_id` | `stamp_correction_requests` | `id`         | CASCADE   |

---

## ユニーク制約

- `users.email` - メールアドレスの重複を防止
- `roles.name` - ロール名の重複を防止
- `attendances` (`user_id`, `date`) - 1ユーザー1日1レコードを保証

